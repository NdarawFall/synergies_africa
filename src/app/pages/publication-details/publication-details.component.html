<!-- Indicateurs de statut -->
<div *ngIf="isLoading" class="status-indicator">
  <p>Chargement en cours...</p>
</div>

<div *ngIf="!isLoading && errorMessage" class="status-indicator error">
  <p>{{ errorMessage }}</p>
  <button (click)="goBack()" class="btn-primary">Retour</button>
</div>

<!-- Le conteneur principal a déjà la garde !ngIf="publication", ce qui est parfait -->
<div *ngIf="!isLoading && publication" class="publication-container">

  <header class="publication-header">
    <button (click)="goBack()" class="back-button">← Retour à la liste</button>

    <!-- À l'intérieur du ngIf, "publication" n'est plus null. C'est sûr. -->
    <h1 class="publication-title">{{ publication.title }}</h1>

    <div class="publication-meta">
      <span class="meta-item">
        <i class="far fa-calendar-alt"></i>
        {{ publication.eventDate | date:'fullDate':'':'fr-FR' }}
      </span>
      <span class="meta-item" *ngIf="publication.location">
        <i class="fas fa-map-marker-alt"></i>
        {{ publication.location }}
      </span>
      <span class="meta-item" *ngIf="publication.userDisplayName">
        <i class="far fa-user"></i>
        Par {{ publication.userDisplayName }}
      </span>
    </div>
  </header>

  <!-- Galerie d'images -->
  <!-- LA CORRECTION EST ICI : on ajoute *ngIf="mainImageUrl" -->
  <div *ngIf="mainImageUrl" class="publication-gallery">

    <div class="main-image">
      <!-- "publication.title" est sûr ici car on est dans le grand ngIf -->
      <img [src]="mainImageUrl" [alt]="publication.title">
    </div>

    <div class="thumbnails-container" *ngIf="publication.photoUrls && publication.photoUrls.length > 1">
      <h3>Autres images</h3>
      <div class="thumbnails">
        <img *ngFor="let url of publication.photoUrls" [src]="url" [alt]="'Vignette de ' + publication.title"
          class="thumbnail" [class.active]="url === mainImageUrl" (click)="changeMainImage(url)">
      </div>
    </div>
  </div>

  <!-- Contenu texte de l'article -->
  <main class="publication-content">
    <div [innerHTML]="publication.content"></div>
  </main>

</div>
